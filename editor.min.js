class Actor{constructor(e){this.id=Utils.id(),this.name=e.name,Object.assign(this,this.properties),this.scriptList=[],Object.assign(this,e),this.scriptList&&this.scriptList.forEach((e,t)=>this.scriptList[t]=new Script(e))}get properties(){var e={sleeping:this.sleeping||!1,x:this.x||0,y:this.y||0,width:this.width,height:this.height,scaleX:this.scaleX,scaleY:this.scaleY,angle:this.angle||0,screen:this.screen||!1,collider:this.collider||"Box",tags:this.tags||"",spriteOn:this.spriteOn||!1,image:this.image||"",color:this.color||"#ffffff",opacity:this.opacity,flipX:this.flipX||!1,flipY:this.flipY||!1,scrollX:this.scrollX||0,scrollY:this.scrollY||0,tileX:this.tileX,tileY:this.tileY,textOn:this.textOn||!1,text:this.text||"",font:this.font||"Arial",size:this.size||30,fill:this.fill||"#000000",style:this.style||"Normal",align:this.align||"Center",offsetX:this.offsetX||0,offsetY:this.offsetY||0,soundOn:this.soundOn||!1,sound:this.sound||"",start:this.start||0,volume:this.volume,pan:this.pan||0,loop:this.loop||!1,physicsOn:this.physicsOn||!1,type:this.type||"Dynamic",fixedAngle:this.fixedAngle||!1,velocityX:this.velocityX||0,velocityY:this.velocityY||0,angularVelocity:this.angularVelocity||0,density:this.density,friction:this.friction,restitution:this.restitution,dampingLinear:this.dampingLinear||0,dampingAngular:this.dampingAngular||0};return null==e.opacity&&(e.opacity=1),null==e.volume&&(e.volume=1),null==e.density&&(e.density=1),null==e.friction&&(e.friction=.5),null==e.restitution&&(e.restitution=.5),null==e.width&&(e.width=50),null==e.height&&(e.height=50),null==e.scaleX&&(e.scaleX=1),null==e.scaleY&&(e.scaleY=1),null==e.tileX&&(e.tileX=1),null==e.tileY&&(e.tileY=1),e}get newProperties(){var e=Object.assign({},this),t=this.properties;return Object.keys(t).forEach(t=>{delete e[t]}),delete e.id,delete e.name,delete e.scriptList,delete e.tags,e}addScript(e,t){this.scriptList.splice(t,0,e)}removeScript(e){this.scriptList.splice(this.scriptList.findIndex(t=>t.id==e),1)}}class App{constructor(e,t){this.file=new File,this.serverGamesFolder=e,this.gameFolder=t,this.load=new LoadingView("var(--mdc-theme-primary)"),document.body.appendChild(this.load.html),this.file.load(this.serverGamesFolder+"/loadJson.php?gameFolder="+this.gameFolder,this)}onFileLoaded(e){this.data=e,this.file.loadAssets(this.serverGamesFolder+"/"+this.gameFolder+"/images",e.imageList,this)}onAssetLoaded(){var e=new Editor(new EditorView,new Game(this.data));new CmdManager(e),document.body.appendChild(e.view.html),this.load.closeDialog()}}class Editor{constructor(e,t){this.view=e,this.model=t,this.selectedSceneIndex=0,this.selectedActorIndex=null,this.selectedScriptIndex=0,this.previousNodeSelected=null,0==t.sceneList.length?this.appBarView=new AppBarView("Untitle"):this.appBarView=new AppBarView(t.sceneList[0].name),this.view.addView(this.appBarView.html),this.canvasView=new CanvasView(t,this.selectedSceneIndex),this.view.addView(this.canvasView.html),this.scriptCanvasView=new ScriptCanvasView,this.view.addView(this.scriptCanvasView.html),this.drawerHeaderView=new DrawerHeaderView(t.name),this.drawerScenesView=new DrawerScenesView(t.sceneList,this.canvasView),this.view.addView(this.drawerScenesView.html),this.view.addView(this.drawerHeaderView.html),this.sideSheetView=new SideSheetView,this.gamePropertiesView=new GamePropertiesView(t),this.sideSheetView.addView(this.gamePropertiesView.html),this.castView=new CastView(this.model.sceneList[this.selectedSceneIndex].actorList,this.model.imageList),this.sideSheetView.addView(this.castView.html),this.actorPropertiesView=new ActorPropertiesView(this.model.sceneList[this.selectedSceneIndex].actorList[0]),this.sideSheetView.addView(this.actorPropertiesView.html),this.actorScriptsView=new ActorScriptsView,this.sideSheetView.addView(this.actorScriptsView.html),this.view.addView(this.sideSheetView.html)}addGameProperty(e,t){this.model[e]=t,this.openGameProperties()}removeGameProperty(e){delete this.model[e],this.openGameProperties()}changeGameProperty(e,t){this.model[e]=t,"name"!=e?(this.openGameProperties(),this.gamePropertiesView.updateGameProperty(e,t),this.canvasView.update(this.model.sceneList[this.selectedSceneIndex].actorList,this.model.allProperties)):(document.querySelector(".mdc-drawer").classList.contains("mdc-drawer--open")||this.drawerToggle(),this.drawerHeaderView.updateGameName(t))}openGameProperties(){this.gamePropertiesView.update(this.model),SideSheetView.openSheetHandler("game-properties"),this.view.openCanvas("canvas")}saveGame(){var e={};Object.assign(e,this.model),delete e.fontList,delete e.imageList,delete e.soundList,File.save(JSON.stringify(e,(e,t)=>{if("id"!=e)return t},"\t")),this.canvasView.takeScreenshot(400,240,0,this.model.sceneList[0].actorList,!0)}playGame(){var e={};Object.assign(e,this.model),e=JSON.stringify(e,(e,t)=>{if("id"!=e)return t},"\t"),localStorage.setItem("localStorage_GameData",e);var t=document.createElement("form");t.setAttribute("method","post"),t.setAttribute("action","../engine/"),t.setAttribute("target","play");var s=document.createElement("input");s.type="text",s.name="gameFolder",s.value=app.gameFolder,t.appendChild(s);var i=document.createElement("input");i.type="text",i.name="serverGamesFolder",i.value=app.serverGamesFolder,t.appendChild(i),document.body.appendChild(t),t.submit(),document.body.removeChild(t)}addScene(e,t){this.model.addScene(e,t);var s=new SceneView;s.addView(e),this.drawerScenesView.addScene(s,t),this.selectScene(e.id)}removeScene(e){this.model.removeScene(e),this.drawerScenesView.removeScene(e),this.model.sceneList.length==this.selectedSceneIndex?this.selectedSceneIndex>0&&this.selectScene(this.model.sceneList[this.selectedSceneIndex-1].id):this.selectScene(this.model.sceneList[this.selectedSceneIndex].id)}renameScene(e,t){this.model.sceneList[this.model.sceneList.findIndex(t=>t.id===e)].name=t,this.drawerScenesView.renameScene(e,t);var s=this.model.sceneList[this.selectedSceneIndex].name;s===t&&this.appBarView.updateSceneName(t)}openSceneMenu(e,t,s){this.drawerScenesView.openSceneMenu(e,t,s)}selectScene(e){var t=this.selectedSceneIndex;if(this.selectedSceneIndex=this.model.sceneList.findIndex(t=>t.id==e),this.drawerScenesView.updateSelectedScene(e),this.appBarView.updateSceneName(this.model.sceneList[this.selectedSceneIndex].name),this.canvasView.update(this.model.sceneList[this.selectedSceneIndex].actorList,this.model.allProperties),this.castView.update(this.model.sceneList[this.selectedSceneIndex].actorList,this.model.imageList),t!=this.selectedSceneIndex)switch(this.selectedActorIndex=null,!0){case SideSheetView.isOpenCast():this.openCast();break;case SideSheetView.isOpenGameProperties():this.openGameProperties();break;default:SideSheetView.closeSheetHandler(),this.view.openCanvas("canvas")}var s=64;this.canvasView.takeScreenshot(s,s,e,this.model.sceneList[this.selectedSceneIndex].actorList,!1)}openCast(){this.castView.update(this.model.sceneList[this.selectedSceneIndex].actorList,this.model.imageList);var e=null;null!=this.selectedActorIndex&&(e=this.model.sceneList[this.selectedSceneIndex].actorList[this.selectedActorIndex].id),this.castView.updateSelectedActor(e),SideSheetView.openSheetHandler("cast"),this.view.openCanvas("canvas")}drawerToggle(){this.appBarView.drawerToogle();var e=null;null!=this.selectedActorIndex&&(e=this.model.sceneList[this.selectedSceneIndex].actorList[this.selectedActorIndex].id),this.canvasView.updateStageDrawer(),SideSheetView.isOpenActorScripts()&&this.scriptCanvasView.updateStageDrawer(),e&&this.canvasView.updateSelectedActor(e)}addActor(e,t,s){var i=this.model.sceneList.findIndex(t=>t.id==e);this.model.sceneList[i].addActor(s,t),this.selectScene(e),this.castView.update(this.model.sceneList[this.selectedSceneIndex].actorList,this.model.imageList),this.selectActor(s.id)}removeActor(e,t){var s=this.model.sceneList.findIndex(t=>t.id==e);this.model.sceneList[s].removeActor(t),this.selectedActorIndex=null,this.selectScene(e)}renameActor(e,t,s){var i=this.model.sceneList.findIndex(t=>t.id==e),a=this.model.sceneList[i].actorList.findIndex(e=>e.id==t);this.model.sceneList[i].actorList[a].name=s,this.selectScene(e),this.openCast(),this.selectActor(t)}changeActorProperty(e,t,s,i){var a=this.model.sceneList.findIndex(t=>t.id==e),n=this.model.sceneList[a].actorList.findIndex(e=>e.id==t),r=this.model.sceneList[a].actorList[n];["width","height","scaleX","scaleY","size","opacity","volume","start","density","friction","restitution","dampingLinear","dampingAngular","tileX","tileY"].includes(s)&&i<=0&&(i=0),s in this.model.sceneList[a].actorList[n]&&(this.model.sceneList[a].actorList[n][s]=i);var o=50,d=50;switch(app.file.loader.resources.hasOwnProperty(r.image)&&(o=app.file.loader.resources[r.image].texture.width,d=app.file.loader.resources[r.image].texture.height),!0){case"image"==s:r.width=o*r.scaleX*r.tileX,r.height=d*r.scaleY*r.tileY,r.spriteOn=!0;break;case"position"==s:r.x=i.x,r.y=i.y;break;case"width"==s:r.scaleX=i/r.tileX/o;break;case"height"==s:r.scaleY=i/r.tileY/d;break;case"scaleX"==s:r.width=o*i*r.tileX;break;case"scaleY"==s:r.height=d*i*r.tileY;break;case"tileX"==s:r.width=o*i*r.scaleX;break;case"tileY"==s:r.height=d*i*r.scaleY;break;case"scale"==s:case"scaleNoUniform"==s:r.x=i.x,r.y=i.y,r.angle=i.angle,r.width=o*i.scaleX*r.tileX,r.height=d*i.scaleY*r.tileY,r.scaleX=i.scaleX,r.scaleY=i.scaleY,r.flipX=i.flipX}this.selectScene(e),this.selectActor(t),"name"==s&&this.openCast()}addActorProperty(e,t,s,i){var a=this.model.sceneList.findIndex(t=>t.id==e),n=this.model.sceneList[a].actorList.findIndex(e=>e.id==t);this.model.sceneList[a].actorList[n][s]=i,this.selectScene(e),this.selectActor(t),this.openActorProperties()}removeActorProperty(e,t,s){var i=this.model.sceneList.findIndex(t=>t.id==e),a=this.model.sceneList[i].actorList.findIndex(e=>e.id==t);delete this.model.sceneList[i].actorList[a][s],this.selectScene(e),this.selectActor(t),this.openActorProperties()}addScript(e,t,s,i){var a=this.model.sceneList.findIndex(t=>t.id==e),n=this.model.sceneList[a].actorList.findIndex(e=>e.id==t);this.model.sceneList[a].actorList[n].addScript(i,s),this.selectScene(e),this.selectActor(t),this.openActorScripts(),this.selectScript(i.id,!1)}removeScript(e,t,s){var i=this.model.sceneList.findIndex(t=>t.id==e),a=this.model.sceneList[i].actorList.findIndex(e=>e.id==t),n=this.model.sceneList[i].actorList[a].scriptList.findIndex(e=>e.id==s);this.model.sceneList[i].actorList[a].removeScript(s),this.selectScene(e),this.selectActor(t),this.openActorScripts(),this.model.sceneList[i].actorList[a].scriptList.length==n?n>0?this.selectScript(this.model.sceneList[i].actorList[a].scriptList[n-1].id,!1):this.view.openCanvas("canvas"):this.selectScript(this.model.sceneList[i].actorList[a].scriptList[this.selectedScriptIndex].id,!1)}renameScript(e,t,s,i){var a=this.model.sceneList.findIndex(t=>t.id==e),n=this.model.sceneList[a].actorList.findIndex(e=>e.id==t),r=this.model.sceneList[a].actorList[n].scriptList.findIndex(e=>e.id==s);this.model.sceneList[a].actorList[n].scriptList[r].name=i,this.selectScene(e),this.selectActor(t),this.openActorScripts(),this.selectScript(s,!1)}openActorMenu(e,t,s){this.castView.openActorMenu(e,t,s)}openActorScriptMenu(e,t,s){this.actorScriptsView.openActorScriptMenu(e,t,s)}selectActor(e){e?(this.selectedActorIndex=this.model.sceneList[this.selectedSceneIndex].actorList.findIndex(t=>t.id==e),SideSheetView.isOpenActorProperties()&&this.openActorProperties(),SideSheetView.isOpenActorScripts()&&this.openActorScripts()):(this.selectedActorIndex=null,(SideSheetView.isOpenActorProperties()||SideSheetView.isOpenActorScripts())&&SideSheetView.closeSheetHandler()),this.canvasView.updateSelectedActor(e),this.castView.updateSelectedActor(e)}openActorProperties(){this.actorPropertiesView.update(this.model.sceneList[this.selectedSceneIndex].actorList[this.selectedActorIndex]),SideSheetView.openSheetHandler("actor-properties"),this.view.openCanvas("canvas")}selectScript(e,t){var s=this.model.sceneList[this.selectedSceneIndex].actorList[this.selectedActorIndex].scriptList;this.selectedScriptIndex=this.model.sceneList[this.selectedSceneIndex].actorList[this.selectedActorIndex].scriptList.findIndex(t=>t.id==e),this.actorScriptsView.updateSelectedScript(e),this.view.openCanvas("scriptcanvas"),this.scriptCanvasView.update(s[this.selectedScriptIndex].nodeList,t)}openActorScripts(){var e=this.model.sceneList[this.selectedSceneIndex].actorList[this.selectedActorIndex].scriptList,t=this.model.sceneList[this.selectedSceneIndex].actorList[this.selectedActorIndex].name;this.actorScriptsView.update(t,e),SideSheetView.openSheetHandler("actor-scripts")}closeActorScripts(){SideSheetView.closeSheetHandler(),this.view.openCanvas("canvas")}selectNode(e){this.previousNodeSelected=e,this.scriptCanvasView.updateSelectedNode(e)}openTags(e){this.input=e,this.tagsDialog=new TagSelectionView(this.model.tagList,this.input);var t=document.querySelector(".editor-frame-root");t.appendChild(this.tagsDialog.html)}addTag(e){this.model.tagList.push(e),this.tagsDialog.add(e)}removeTag(e){var t=this.model.tagList.findIndex(t=>t==e);this.model.tagList.splice(t,1)}addNode(e,t,s,i,a){var n=this.model.sceneList.findIndex(t=>t.id==e),r=this.model.sceneList[n].actorList.findIndex(e=>e.id==t),o=this.model.sceneList[n].actorList[r].scriptList.findIndex(e=>e.id==s);this.model.sceneList[n].actorList[r].scriptList[o].addNode(i,a),this.selectScene(e),this.selectActor(t),this.openActorScripts(),this.selectScript(s,!1),this.selectNode(a.id)}removeNode(e,t,s,i){var a=this.model.sceneList.findIndex(t=>t.id==e),n=this.model.sceneList[a].actorList.findIndex(e=>e.id==t),r=this.model.sceneList[a].actorList[n].scriptList.findIndex(e=>e.id==s);this.model.sceneList[a].actorList[n].scriptList[r].removeNode(i),this.scriptCanvasView.update(this.model.sceneList[a].actorList[n].scriptList[r].nodeList),this.selectScene(e),this.selectActor(t),this.openActorScripts(),this.selectScript(s,!1),this.selectNode(null)}changeNode(e,t,s,i,a){var n=this.model.sceneList.findIndex(t=>t.id==e),r=this.model.sceneList[n].actorList.findIndex(e=>e.id==t),o=this.model.sceneList[n].actorList[r].scriptList.findIndex(e=>e.id==s);this.model.sceneList[n].actorList[r].scriptList[o].changeNode(i,a),this.selectScene(e),this.selectActor(t),this.openActorScripts(),this.selectScript(s,!1),this.selectNode(i)}getTagList(){return this.model.tagList}getActorList(){var e=[];return this.model.sceneList[this.selectedSceneIndex].actorList.forEach(t=>{e.push(t.name)}),e.sort()}getSceneList(){var e=[];return this.model.sceneList.forEach(t=>{e.push(t.name)}),e}getPropertiesList(e,t){var s=null,i=[];switch(e){case"Game":var a=Object.assign(this.model.newProperties,this.model.properties);i=Object.assign(a,this.model.inputProperties);break;case"Me":s=this.model.sceneList[this.selectedSceneIndex].actorList[this.selectedActorIndex],i=Object.assign(s.newProperties,s.properties);break;default:var n=this.model.sceneList[this.selectedSceneIndex].actorList.findIndex(t=>t.name==e);s=this.model.sceneList[this.selectedSceneIndex].actorList[n],i=Object.assign(s.newProperties,s.properties)}switch(t){case"Boolean":i=this.checkType(i,"boolean");break;case"Number":i=this.checkType(i,"number")}return Object.keys(i)}checkType(e,t){var s={};return Object.keys(e).forEach(i=>{var a=new Object;a[i]=e[i],typeof e[i]==t&&Object.assign(s,a)}),s}openAssets(e,t,s){var i=[];switch(s){case"Sound":i=this.model.soundList;break;case"Font":i=this.model.fontList;break;default:i=this.model.imageList}this.assetDialog=new AssetSelectionView(i,e,s,this.canvasView);var a=t.split(","),n=[];a.forEach(e=>{var t=i.findIndex(t=>t.name==e);-1!=t&&n.push(i[t].id)}),this.assetDialog.updateSelectedAsset(n);var r=document.querySelector(".editor-frame-root");r.appendChild(this.assetDialog.html),this.openAssetsDialog=!0}selectAsset(e){var t=[];t[0]=e,this.assetDialog.updateSelectedAsset(t)}uploadFile(e,t){var s=new FormData;s.append("file",e,e.name),File.uploadFile(e,s,t)}addAsset(e,t){var s=new Object({id:Utils.id(),name:e});this.model.addAsset(s,t),"Image"!=t&&"Animation"!=t||this.canvasView.loadImage(s.name);var i=new AssetView(s,t);this.assetDialog.addAsset(i)}deleteFile(e,t,s){File.deleteFile(app.gameFolder,e,t,s)}removeAsset(e,t){if("Image"==t||"Animation"==t){var s=this.model.imageList.findIndex(t=>t.id==e);this.canvasView.deleteImage(this.model.imageList[s].name)}this.model.removeAsset(e,t),this.assetDialog.removeAsset(e)}closeAsset(){var e=document.querySelector(".dialog-full-screen");e.parentNode.removeChild(e),this.openAssetsDialog=!1,this.canvasView.update(this.model.sceneList[this.selectedSceneIndex].actorList,this.model.allProperties)}}class File{load(e,t){var s=new XMLHttpRequest;s.onreadystatechange=function(){if(this.readyState==this.DONE&&200==this.status){var e=JSON.parse(this.responseText);t.onFileLoaded(e)}},s.open("GET",e,!0),s.send()}loadAssets(e,t,s){this.loader=new PIXI.Loader(e),t?this.loader.add(t):this.loader.add("Loader","http://localhost/editor/images/gamesonomy.png"),this.loader.onLoad.add((e,t)=>{}),this.loader.load(()=>{s.file.loader.resources.hasOwnProperty("Loader")&&(s.file.loader.resources.Loader.texture.destroy(!0),delete s.file.loader.resources.Loader),s.onAssetLoaded()})}static save(e){var t=app.serverGamesFolder+"/saveJson.php?gameId="+app.gameId+"&gameFolder="+app.gameFolder,s=new XMLHttpRequest;s.open("POST",t,!0),s.setRequestHeader("Content-type","application/json"),s.onreadystatechange=function(){4==s.readyState&&(200==s.status?alert(s.responseText):alert("Server Error! "+s.responseText))},s.send(e)}static uploadFile(e,t,s){var i;switch(!0){case"Image"==s||"Animation"==s:i="images";break;case"Sound"==s:i="sounds";break;case"ScreenShoot"==s:i=""}var a=app.serverGamesFolder+"/uploadFile.php?gameFolder="+app.gameFolder+"&assetFolder="+i,n=new XMLHttpRequest;n.open("POST",a,!0),n.type=s,n.fileName=e.name,n.onreadystatechange=function(){4==n.readyState&&(200==n.status?""!=i&&Command.addAssetCmd(this.fileName,this.type):alert("Server Error! "+n.responseText))},n.send(t)}static deleteFile(e,t,s,i){var a="";"Image"==i||"Animation"==i?a="images":"Sound"==i&&(a="sounds");var n=app.serverGamesFolder+"/deleteAsset.php?gameFolder="+e+"&assetFolder="+a+"&filename="+s,r=new XMLHttpRequest;r.assetID=t,r.fileName=s,r.type=i,r.open("GET",n,!0),r.onreadystatechange=function(){4==r.readyState&&(200==r.status?Command.removeAssetCmd(t,i):alert("Server Error! "+r.responseText))},r.send()}}class Game{constructor(e){if(this.name="Untitled Game",Object.assign(this,this.properties),this.tagList=[],this.imageList=[],this.fontList=[],this.soundList=[],this.sceneList=[],Object.assign(this,e),this.imageList&&this.imageList.forEach((e,t)=>this.imageList[t]=new Object({id:Utils.id(),name:e.name})),this.soundList&&this.soundList.forEach((e,t)=>this.soundList[t]=new Object({id:Utils.id(),name:e.name})),this.fontList=["Arial","Arial Black","Courier New","Georgia","Helvetica","Impact","Tahoma","Times New Roman","Verdana"],this.fontList&&this.fontList.forEach((e,t)=>this.fontList[t]={id:Utils.id(),name:e}),this.fontList&&this.fontList.forEach((e,t)=>this.fontList[t]=new Object(e)),0!=this.sceneList.length)this.sceneList.forEach((e,t)=>this.sceneList[t]=new Scene(e));else{var t=new Scene({id:Utils.id(),name:"Scene_1",actorList:[]});this.sceneList.push(t)}}get properties(){var e={displayWidth:this.displayWidth||800,displayHeight:this.displayHeight||480,cameraX:this.cameraX||0,cameraY:this.cameraY||0,cameraAngle:this.cameraAngle||0,cameraZoom:this.cameraZoom,backgroundColor:this.backgroundColor||"#ffffff",soundOn:this.soundOn||!1,soundtrack:this.soundtrack||"",volume:this.volume||1,start:this.start||0,pan:this.pan||0,loop:this.loop||!1,physicsOn:this.physicsOn||!0,gravityX:this.gravityX||0,gravityY:this.gravityY||-9.8};return null==e.cameraZoom&&(e.cameraZoom=1),e}get newProperties(){var e=Object.assign({},this),t=this.properties;return Object.keys(t).forEach(t=>{delete e[t]}),delete e.name,delete e.imageList,delete e.soundList,delete e.fontList,delete e.sceneList,delete e.tagList,e}get inputProperties(){var e={FPS:0,time:0,exit:!1,currentScene:"",currentSceneNumber:0,deltaTime:0,mouseX:0,mouseY:0,accelerationX:0,accelerationY:0,accelerationZ:0,latitude:0,longitude:0};return e}get allProperties(){var e=Object.assign({},this.properties);return e=Object.assign(e,this.newProperties),e=Object.assign(e,this.inputProperties),e}addScene(e,t){this.sceneList.splice(t,0,e)}removeScene(e){this.sceneList.splice(this.sceneList.findIndex(t=>t.id==e),1)}addAsset(e,t){switch(t){case"Sound":this.soundList.push(e);break;case"Font":this.fontList.push(e);break;default:this.imageList.push(e)}}removeAsset(e,t){switch(t){case"Sound":this.soundList.splice(this.soundList.findIndex(t=>t.id==e),1);break;case"Font":this.fontList.splice(this.fontList.findIndex(t=>t.id==e),1);break;default:this.imageList.splice(this.imageList.findIndex(t=>t.id==e),1)}}}class Node{constructor(e){this.id=Utils.id(),Object.assign(this,e)}}class Scene{constructor(e){this.id=Utils.id(),this.name=e.name,this.actorList=[],Object.assign(this,e),this.actorList&&this.actorList.forEach((e,t)=>this.actorList[t]=new Actor(e))}addActor(e,t){this.actorList.splice(t,0,e)}removeActor(e){this.actorList.splice(this.actorList.findIndex(t=>t.id==e),1)}}class Script{constructor(e){this.id=Utils.id(),this.name=e.name,this.nodeList=[],Object.assign(this,e),this.assignNodes(this.nodeList)}addNode(e,t){if(null==e.parentID)this.nodeList.splice(e.position,0,t);else{var s=this.findNode(this.nodeList,e.parentID);s&&("right"==e.side?s.list[s.position].nodeListTrue.splice(e.position,0,t):"left"==e.side&&s.list[s.position].nodeListFalse.splice(e.position,0,t))}}removeNode(e){var t=this.findNode(this.nodeList,e);t&&t.list.splice(t.position,1)}changeNode(e,t){var s=this.findNode(this.nodeList,e);s.list[s.position].parameters=t}assignNodes(e){e&&e.forEach((t,s)=>{e[s]=new Node(t),t.hasOwnProperty("nodeListTrue")&&(t.nodeListTrue&&this.assignNodes(t.nodeListTrue),t.nodeListFalse&&this.assignNodes(t.nodeListFalse))})}findNode(e,t,s,i){for(var a=0,n=void 0;a<e.length;){if(e[a].id==t)return{list:e,position:a,parentID:s,side:i};if(e[a].nodeListTrue&&(n=this.findNode(e[a].nodeListTrue,t,e[a].id,"right"),n))return n;if(e[a].nodeListFalse&&(n=this.findNode(e[a].nodeListFalse,t,e[a].id,"left"),n))return n;a++}}}class Utils{static newName(e,t){var s,i=e.split("_");if(isNaN(i[i.length-1])||"copy"!=i[i.length-2])"copy"!=i[i.length-1]&&(e+="_copy");else{e="";for(var a=0;a<i.length-1;a++)e=e+i[a]+"_";e=e.substring(0,e.length-1)}var n=Boolean(-1==t.findIndex(t=>t.name==e));if(n)s=e;else{var r=2;for(s=e+"_"+r;t&&-1!=t.findIndex(e=>e.name==s);)r++,s=e+"_"+r}return s}static randomColor(e){return"rgba("+Math.floor(256*Math.random())+", "+Math.floor(256*Math.random())+", "+Math.floor(256*Math.random())+", "+(e||1)+")"}static getHexColor(e){return"#"+(e>>>0).toString(16).slice(-6)}static radians(e){return e*Math.PI/180}static degrees(e){return 180*e/Math.PI}static angleBetweenTwoPoints(e,t){return Math.atan2(t.y-e.y,t.x-e.x)}static distanceBetweenTwoPoints(e,t){return Math.hypot(t.x-e.x,t.y-e.y)}static rotatePoint(e,t){t=t*Math.PI/180;var s=e.x*Math.cos(t)-e.y*Math.sin(t),i=e.x*Math.sin(t)+e.y*Math.cos(t);return{x:s,y:i}}static id(){return"_"+(new Date).valueOf()+Math.random().toFixed(16).substring(2)}static UUID(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}static keyPressHandler(e,t){var s=String.fromCharCode(t.which),i=e.value,a=" abcdefghijklmn√±opqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890";return(a.indexOf(s)<0||i.length>=20)&&t.preventDefault(),!0}static scaleToWindow(e,t){var s,i,a,n,r;s=window.innerWidth/e.offsetWidth,i=window.innerHeight/e.offsetHeight,a=Math.min(s,i),e.style.transformOrigin="0 0",e.style.transform="scale("+a+")",n=e.offsetWidth>e.offsetHeight?e.offsetWidth*a<window.innerWidth?"horizontally":"vertically":e.offsetHeight*a<window.innerHeight?"vertically":"horizontally","horizontally"===n&&(r=(window.innerWidth-e.offsetWidth*a)/2,e.style.marginTop="0px",e.style.marginBottom="0px",e.style.marginLeft=r+"px",e.style.marginRight=r+"px"),"vertically"===n&&(r=(window.innerHeight-e.offsetHeight*a)/2,e.style.marginTop=r+"px",e.style.marginBottom=r+"px",e.style.marginLeft="0px",e.style.marginRight="0px"),e.style.paddingLeft="0px",e.style.paddingRight="0px",e.style.paddingTop="0px",e.style.paddingBottom="0px",e.style.display="block",document.body.style.backgroundColor=t;var o=navigator.userAgent.toLowerCase();return-1!=o.indexOf("safari")&&o.indexOf("chrome"),a}}